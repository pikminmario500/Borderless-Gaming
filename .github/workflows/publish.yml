name: publish Borderless Gaming


on:
  push:
    tags:
      - "*.*.*"

jobs:
  publish:
    name: Publish Release
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@main
        with:
            fetch-depth: 0

      - name: Setup .NET
        uses: actions/setup-dotnet@main
        with:
          dotnet-version: "8.0.x" # SDK Version to use; x will use the latest version of the 7.0 channel

      - name: Install bebopc
        shell: pwsh
        run: $version = '3.1.2'; $script = irm "https://bebop.sh"; & ([scriptblock]::Create($script)) -bebopcVersion $version

      - name: Build release
        shell: pwsh
        run: ./scripts/build-release.ps1

      - name: Upload artifact
        uses: actions/upload-artifact@main
        with:
          name: installer
          path: ./Installers/BorderlessGaming${{ env.RELEASE_VERSION }}_admin_setup.exe

      - name: Create Release
        id: create_release
        uses: actions/create-release@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Borderless Gaming ${{ github.ref }}
          draft: false
          prerelease: false

      - name: Upload installer
        uses: actions/upload-release-asset@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./Installers/BorderlessGaming${{ env.RELEASE_VERSION }}_admin_setup.exe
          asset_name: installer-win64.exe
          asset_content_type: application/octet-stream
        